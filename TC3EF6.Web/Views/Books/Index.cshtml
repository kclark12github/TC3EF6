@*@model PagedList.IPagedList<TC3EF6.Domain.Classes.Stash.Book>*@
@model IEnumerable<TC3EF6.Domain.Classes.Stash.Book>
@*@using PagedList.Mvc;*@
@*<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />*@

@*<div class="row">
        <div class="col-md-12">
            <div class="panel panel-primary list-panel" id="list-panel">
                <div class="panel-heading list-panel-heading">
                    <h1 class="panel-title list-panel-title" style="color: white">@ViewBag.Title</h1>
                    <button type="button" class="btn btn-default btn-md" data-toggle="modal" data-target="#advancedSearchModal" id="advancedsearch-button">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span> Advanced Search
                    </button>
                </div>
                <div class="panel-body">
                    <table id="books-data-table" class="table table-striped table-bordered" style="width:100%"></table>
                </div>
            </div>
        </div>
    </div>*@
<div class="card" id="list-panel">
    <div class="card-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="card-title list-panel-title">@ViewBag.Title</h1>
            </div>
            <div class="col-auto">
                <button type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#newModal" id="new-button">
                    <span class="fas fa-plus-square mr-1"></span><span>New</span>
                </button>
                <button type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#filterModal" id="filter-button">
                    <span class="fas fa-filter mx-2"></span><span>Filter</span>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <table id="books-data-table" class="table table-striped table-bordered table-hover"></table>
    </div>
</div>

@Html.Action("AdvancedSearch")

@* Edit:    <i class="fas fa-pen-square"></i> *@
@* New:     <i class="fas fa-plus-square"></i> *@
@* Copy:    <i class="fas fa-copy"></i> *@
@* Delete:  <i class="fas fa-minus-square"></i> *@

@* Search:  <i class="fas fa-search"></i> *@
@* Filter:  <i class="fas fa-filter"></i> *@
@* Sort:    <i class="fas fa-sort"></i> *@
@* Report:  <i class="fas fa-file-invoice"></i> *@
@* SQL:     <i class="fas fa-database"></i> *@

@section Scripts
{
    <script type="text/javascript">
        var bookListVM;
        $(function () {
            bookListVM = {
                dt: null,
                init: function () {
                    dt = $('#books-data-table').DataTable({
                        "fixedHeader": { "footer": true },
                        "buttons": ['copy', 'excel', 'pdf', 'colvis'],
                        //"dom": 'Blfiprtip',
                        //"dom": '<"top"Blfir>pt<"bottom"ip><"clear">',                        "searching": true,
                        //"dom": "<'row'<'col-sm-12'tr>>" +
                        //    "<'row'<'col-sm-4'l><'col-sm-8'p>>",
                        "dom": "<'row'<'col'l><'col'i><'col'p>>" +
                            "<'row'<'col'r><'col-sm-12'f>>" +
                            "<'row'<'col't>>" +
                            "<'row'<'col'B><'col'i><'col'p>>",
                        "select": true,
                        "serverSide": true,
                        "processing": true,
                        "ajax": {
                            "url": "@Url.Action("Get","Books")",
                            "data": function (data) {
                                //data.Details = null;
                                data.ID = $("#ID").val();
                                data.AlphaSort = $("#AlphaSort").val();
                                data.Title = $("#Title").val();
                                data.Author = $("#Author").val();
                                data.Media = $("#Media").val();
                                data.ISBN = $("#ISBN").val();
                                data.Location = $("#Location").val();
                            }
                        },
                        "columns": [
                            //{ "title": "Details",         "searchable": false,    "defaultContent": "<span class=\"fas fa-info-circle\"></span>" },
                            { "title": "ID",        "data": "ID",           "visible": false,       "defaultContent": "<i>Null</i>" },
                            { "title": "AlphaSort", "data": "AlphaSort",    "searchable": true,     "defaultContent": "<i>Null</i>" },
                            { "title": "Title",     "data": "Title",        "searchable": true,     "defaultContent": "<i>Null</i>" },
                            { "title": "Author",    "data": "Author",       "searchable": true,     "defaultContent": "<i>Null</i>" },
                            { "title": "Media",     "data": "MediaFormat",  "searchable": true,     "defaultContent": "<i>Null</i>" },
                            { "title": "ISBN",      "data": "ISBN",         "searchable": true,     "defaultContent": "<i>Null</i>" },
                            { "title": "Location",  "data": "Location",     "searchable": true,     "defaultContent": "<i>Null</i>" }
                        ],
                        "displayStart": 0, "pageLength": 25,
                        "lengthMenu": [[10, 25, 50, 100, 1000, -1], [10, 25, 50, 100, 1000, "All"]],
                    });
                },
                refresh: function () {
                    dt.ajax.reload();
                }
            }
            //table.buttons().container()
            //    .appendTo('#books-data-table_wrapper .col-md-6:eq(0)');
            
            $('#btnPerformFilter').on("click", bookListVM.refresh); // Modal Filter button click handler
            bookListVM.init();  // initialize the datatables

            var table = $('#books-data-table').DataTable();
            $('#books-data-table tbody').on('click', 'tr', function () {
                var data = table.row(this).data();
                console.log(`You clicked on ID #${data['ID']}; AlphaSort "${data['AlphaSort']}"`);
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');
                } else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js"></script>
}